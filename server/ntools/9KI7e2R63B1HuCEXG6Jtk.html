<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>OpenAPI Schema Ref Builder ğŸ’</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
  background-color: #f4f6f9;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.container {
  max-width: 1000px;
  margin-top: 40px;
}
.card {
  border: none;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}
.card-header {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  border-radius: 15px 15px 0 0 !important;
  font-size: 1.3rem;
  font-weight: 600;
}
textarea {
  font-family: monospace;
  resize: vertical;
  direction: ltr;
}
.schema-card {
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  background: #fff;
  margin-bottom: 10px;
  padding: 10px 14px;
  transition: all 0.15s ease-in-out;
}
.schema-card:hover {
  transform: scale(1.01);
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
}
.schema-title {
  font-weight: 600;
  font-size: 1rem;
  color: #0d6efd;
  margin-bottom: 6px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.schema-body {
  display: none;
  padding-top: 5px;
  padding-right: 5px;
  font-size: 0.85rem;
}
.schema-field {
  margin-bottom: 3px;
  font-family: monospace;
}
.schema-field strong {
  color: #6c757d;
}
.copied {
  background-color: #d4f8d4 !important;
}
.copy-btn {
  background-color: #f8f9fa;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 0.8rem;
  padding: 2px 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.copy-btn:hover {
  background-color: #e9ecef;
}
.arrow {
  transition: transform 0.25s ease;
}
.arrow.down {
  transform: rotate(90deg);
}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="card-header text-center">
      ğŸ§© OpenAPI Schema Ref Builder
    </div>
    <div class="card-body">

      <!-- Template -->
      <div class="mb-3">
        <label class="form-label fw-bold">ğŸ“„ ×ª×‘× ×™×ª (× ×™×ª×Ÿ ×œ×©× ×•×ª):</label>
        <textarea id="templateInput" class="form-control" rows="5">content:
  application/json:
    schema:
      $ref: '#/components/schemas/'
</textarea>
      </div>

      <!-- YAML -->
      <div class="mb-3">
        <label class="form-label fw-bold">ğŸ“œ ×§×•×‘×¥ YAML ×©×œ×š:</label>
        <textarea id="yamlInput" class="form-control" rows="7" placeholder="×”×“×‘×§ ×›××Ÿ ××ª ×§×•×‘×¥ ×”Ö¾OpenAPI YAML ×©×œ×š..."></textarea>
      </div>

      <!-- Controls -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <button id="loadBtn" class="btn btn-primary px-4">ğŸš€ ×˜×¢×Ÿ YAML</button>
        <input id="search" type="text" class="form-control w-50" placeholder="ğŸ” ×—×¤×© ×©×, ×ª×•×›×Ÿ ××• ×‘×™×˜×•×™ ×›××• type:">
      </div>

      <!-- Schema List -->
      <div id="schemas" class="mt-4"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script>
let schemas = {};
let schemaNames = [];

// ×˜×¢×™× ×ª YAML
document.getElementById('loadBtn').addEventListener('click', () => {
  const yamlText = document.getElementById('yamlInput').value.trim();
  if (!yamlText) {
    alert("×× × ×”×“×‘×§ YAML ×œ×¤× ×™ ×”×˜×¢×™× ×”!");
    return;
  }
  try {
    const data = jsyaml.load(yamlText);
    schemas = data.components?.schemas || {};
    schemaNames = Object.keys(schemas);
    const container = document.getElementById('schemas');
    if (schemaNames.length === 0) {
      container.innerHTML = '<div class="alert alert-warning mt-2">âš ï¸ ×œ× × ××¦××• ×¡×›××•×ª ×‘×§×•×‘×¥.</div>';
      return;
    }
    renderSchemas(schemaNames);
  } catch (e) {
    document.getElementById('schemas').innerHTML =
      '<div class="alert alert-danger mt-2">âŒ ×©×’×™××” ×‘× ×™×ª×•×— YAML: ' + e.message + '</div>';
  }
});

// ×¨×™× ×“×•×¨ ×¡×›××•×ª
function renderSchemas(list) {
  const container = document.getElementById('schemas');
  container.innerHTML = '';

  list.forEach(name => {
    const schema = schemas[name];
    const card = document.createElement('div');
    card.className = 'schema-card';

    const title = document.createElement('div');
    title.className = 'schema-title';
    title.innerHTML = `
      <span>${name}</span>
      <div>
        <button class="copy-btn me-2" title="×”×¢×ª×§ ×ª×‘× ×™×ª">ğŸ“‹ ×”×¢×ª×§</button>
        <span class="arrow">â–¶</span>
      </div>
    `;

    const body = document.createElement('div');
    body.className = 'schema-body';

    let html = '';
    for (const key in schema) {
      let value = schema[key];
      if (typeof value === 'object') {
        value = JSON.stringify(value, null, 2)
          .replace(/[{}"]/g, '')
          .replace(/,/g, '')
          .trim();
      }
      html += `<div class="schema-field"><strong>${key}:</strong> ${value}</div>`;
    }
    body.innerHTML = html || '<div class="text-muted small">(××™×Ÿ ××™×“×¢ × ×•×¡×£)</div>';

    // ×¤×ª×™×—×”/×¡×’×™×¨×”
    title.querySelector('.arrow').addEventListener('click', (e) => {
      e.stopPropagation();
      const visible = body.style.display === 'block';
      body.style.display = visible ? 'none' : 'block';
      e.target.classList.toggle('down', !visible);
    });

    // ×”×¢×ª×§×”
    title.querySelector('.copy-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      copyFullTemplate(name, card);
    });

    card.appendChild(title);
    card.appendChild(body);
    container.appendChild(card);
  });
}

// ×”×¢×ª×§×ª ×ª×‘× ×™×ª ××œ××”
function copyFullTemplate(name, div) {
  const template = document.getElementById('templateInput').value;
  let finalText = template;
  const match = template.match(/(#\/components\/schemas\/)(['"]?)/);
  if (match) {
    finalText = template.replace(/(#\/components\/schemas\/)(['"]?)/, `$1${name}$2`);
  } else {
    finalText = template + name;
  }

  const tempArea = document.createElement('textarea');
  tempArea.value = finalText;
  document.body.appendChild(tempArea);
  tempArea.select();
  document.execCommand('copy');
  document.body.removeChild(tempArea);

  const btn = div.querySelector('.copy-btn');
  const originalText = btn.textContent;
  btn.textContent = 'âœ… ×”×•×¢×ª×§!';
  btn.style.backgroundColor = '#d4f8d4';
  setTimeout(() => {
    btn.textContent = originalText;
    btn.style.backgroundColor = '';
  }, 1200);
}

// ×—×™×¤×•×© â€” ×›×•×œ×œ type:, description:, ×•×›×•×³
document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase().replace(/[:]/g, '').trim();
  const filtered = schemaNames.filter(s => {
    const fullText = JSON.stringify(schemas[s]).toLowerCase();
    const clean = fullText.replace(/[:{}"']/g, '');
    return (
      s.toLowerCase().includes(q) ||
      fullText.includes(q) ||
      clean.includes(q)
    );
  });
  renderSchemas(filtered);
});
</script>
</body>
</html>
