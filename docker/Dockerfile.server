FROM node:20-bullseye

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

# Prisma client generation (requires DATABASE_URL to be set, even if DB isn't reachable at build time)
ENV DATABASE_URL=postgresql://admin:admin@postgres:5432/main?schema=public
RUN npx prisma generate

EXPOSE 4000

CMD ["npm", "start"]
